<!DOCTYPE html>
<html>
<head>
	<title>Inventarios</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<style type="">
		body{
			background: #E0EAFC;  /* fallback for old browsers */
			background: -webkit-linear-gradient(to right, #CFDEF3, #E0EAFC);  /* Chrome 10-25, Safari 5.1-6 */
			background: linear-gradient(to right, #CFDEF3, #E0EAFC); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
		}

		*{
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		#root{
			width: 100%;
		}
	/*	.container-fluid-md{
			display: flex;
	  				justify-content: center;
	  				width: 400px;
	  				height: 100px;
		}*/

		/*#contenedor{
				display: flex; justify-content: center; align-items: center; padding: 1rem;
		}
*/
		@media only screen and (max-width: 768px) {
	  		
			
	  			#root{
	  				display: flex;
	  				justify-content: center;
	  				margin: 0 auto;
	  				width: 80%;
	  				
	  			}
		}	
	</style>
</head>
<body>



	<div id="contenedor" class="container-fluid">
		<form method="POST" id="form-inventarios">
		<div class="row m-3 ">
		  <div class="col-sm-2 mb-2 ">
		  	<select class="form-select" class="unidadtiempo" id="unidadtiempo" name="unidadtiempo" >
				  <option selected>Seleccione unidad de tiempo</option>
				  <option value="dias">Días</option>
				  <option value="meses">Meses</option>
				  <option value="años">Años</option>
				  <option value="semanas">Semanas</option>
				  <option value="horas">Horas</option>
		</select>
		   
		  </div>
		  <div class="col-sm-2 mb-2">
		    <input type="text" class="form-control costoarticulo" name="costoarticulo" placeholder="Costo artículo(c)" >
		  </div>
		  <div class="col-sm-2 mb-2">
		    <input type="text" class="form-control costoalmacenamiento" name="costoalmacenamiento" placeholder="Costo almacenamiento(h)" >
		  </div>
		   <div class="col-sm-2 mb-2">
		    <input type="text" class="form-control costofijo" name="costofijo" placeholder="Costo fijo(K)" >
		  </div>
		   <div class="col-sm-2 mb-2">
		    <input type="text" class="form-control tasaconsumo" name="tasaconsumo" placeholder="Tasa consumo(a)" >
		  </div>
		   <div class="col-sm-2 mb-2">
		    <input type="text" class="form-control tiempoentrega" name="tiempoentrega" placeholder="Tiempo de entrega(L)" >
		  </div>
		  <div class="col-sm-2 mb-2">
		    <input type="text" class="form-control tiempoactual" name="tiempoactual" placeholder="Tiempo calculo inventario actual" >
		  </div>

		  <div class="form-check">
			  <input class="form-check-input" type="checkbox" id="confaltantes">
			  <label class="form-check-label" for="flexCheckDefault">
			   Con faltantes
			  </label>
		 </div>

		  <div class="col-sm-2 mb-2">
		    <input type="text" class="form-control penalizacion" name="penalizacion" placeholder="Penalización" >
		  </div>
		  
		</div>
		 <div class="col-sm-2 mb-2 mx-auto">
		    <input type="submit" class="form-control" value="Analizar" >
		  </div>
		</form>
		<div class="row">
			<div class="col">
				<div class="accordion" id="accordionExample">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
         Cantidad de artículos a adquirir
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse " aria-labelledby="headingOne" data-bs-parent="#accordionExample">
      <div class="accordion-body QA" >
      	
       
      </div>
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingTwo">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
       	Frecuencia que se debe hacer el pedido
      </button>
    </h2>
    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample"> 
      <div class="accordion-body tA">
       
      </div>
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
        Costo de efectuar el pedido
      </button>
    </h2>
    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body T">
        
      </div>
    </div>
  </div>

  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4" aria-expanded="false" aria-controls="collapse4">
        Tiempo efectivo de colocar el nuevo pedido
      </button>
    </h2>
    <div id="collapse4" class="accordion-collapse collapse" aria-labelledby="headingfour" data-bs-parent="#accordionExample">
      <div class="accordion-body tr">
        
      </div>
    </div>
  </div>


  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse5" aria-expanded="false" aria-controls="collapse5">
        Nivel del inventario para hacer nuevo pedido
      </button>
    </h2>
    <div id="collapse5" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body nivel">
        
      </div>
    </div>
  </div>

  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse6" aria-expanded="false" aria-controls="collapse6">
        Función de costos
      </button>
    </h2>
    <div id="collapse6" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body">
      	<div id="root">
	        		
	        	</div>
        
      </div>
    </div>
  </div>

  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse7" aria-expanded="false" aria-controls="collapse7">
        Función de inventario y gráficas
      </button>
    </h2>
    <div id="collapse7" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body ">

      	<div id="finventario">
	        		
	       </div>
        	
      </div>
    </div>
  </div>

  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse8" aria-expanded="false" aria-controls="collapse8">
        Tiempo deseado para calcular el inventario actual
      </button>
    </h2>
    <div id="collapse8" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body tiempodeseado">
        
      </div>
    </div>
  </div>

  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse8" aria-expanded="false" aria-controls="collapse8">
        Tiempo deseado para calcular el inventario actual
      </button>
    </h2>
    <div id="collapse8" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body tiempodeseado">
        
      </div>
    </div>
  </div>
  <div class="accordion-item" id="fraccion">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse8" aria-expanded="false" aria-controls="collapse8">
        Fracción del tiempo en el que no existen faltantes
      </button>
    </h2>
    <div id="collapse8" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body fracciontiempo">
        
      </div>
    </div>
  </div>


</div>
			</div>
		</div>

		<div class="row">
			<div class="col"></div>	
	        <div class="col">
	        	
	        </div>
	        <div class="col"></div>	
        
    </div>
		
	</div>

<script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
 <script src="https://unpkg.com/function-plot/dist/function-plot.js"></script>

<script type="text/javascript">



	
	function obtenerSA(a,K,h,p){
		return Math.sqrt((2*a*K)/h)*Math.sqrt(p/(p+h));
	}
	
	function obtenerQA(a,K,h){
		return Math.round(Math.sqrt((2*a*K)/h));
	}

	function obtenerTA(a,K,h){
		return Math.sqrt((2*K)/(a*h));
	}
	function obtenerCostoPedido(a,K,QA,h,c){
		return Math.round((a*K)/QA+(a*c)+(h*QA)/2);
	}

	function obtenerTr(L,tA){
		return (L-Math.floor(L/tA)*tA);
	}

	function obtenerLimiteInventario(QA,tA,tr,a){
		return QA-(tA-tr)*a;
	}
	
	function mostrarGraficoCostos(a,K,QA,c,h){
		let contentsBounds = document.body.getBoundingClientRect();
			let width = 600;
			let height = 300;
			var funcion = (a*c).toString()+"+"+(a*K).toString()+"/x+"+(h/2).toString()+"x";
			
			//var funcion = (a*K/x)+(a+c)+(h*x/2);
			// alert(a*K); //va entre x
			// alert(a*c);
			// alert(h/2);
			// alert((a*c).toString()+"+"+(a*K).toString()+"/x+"+(h/2).toString()+"x");
			functionPlot({
			  target: "#root",
			 
			  yAxis: { domain: [c, QA] },

			  grid: true,
			  data: [
			    {
			      fn: funcion.toString()
			    }
			  ]
			});
	}

	function mostrarGraficoInventario(a,tA,QA,c){
		let contentsBounds = document.body.getBoundingClientRect();
			let width = 600;
			let height = 300;
			var funcion = (QA).toString()+"-"+"x%"+(tA).toString()+"*"+(a).toString();
		
			//var funcion = (a*K/x)+(a+c)+(h*x/2);
			// alert(a*K); //va entre x
			// alert(a*c);
			// alert(h/2);
			// alert((a*c).toString()+"+"+(a*K).toString()+"/x+"+(h/2).toString()+"x");
			functionPlot({
			  target: "#finventario",
			 
			  yAxis: { domain: [c, QA] },

			  grid: true,
			  data: [
			    {
			      fn: funcion.toString()
			    }
			  ]
			});
	}

	function calcularInventarioActual(QA,t,a,tA){
		return QA-(t%tA)*a;
	}
</script>
<script type="text/javascript">
	$(".penalizacion").css('display','none');
	$("#fraccion").css('display','none');
	
	$("#confaltantes").click(function(e){
		
		if(this.checked){
			$(".penalizacion").css('display','block');
			$("#fraccion").css('display','block');
			//alert("siuuuuuuuuuuuuuuuu");
		}else{
			$(".penalizacion").css('display','none');
			$("#fraccion").css('display','none');
			$(".penalizacion").val("");
		}
		
	});
	
	$("#form-inventarios").submit(function(e){
		$('.fracciontiempo').empty();
  		$('.QA').empty();
		$('.tA').empty();
		$('.T').empty();
		$('.tr').empty();
		$('.nivel').empty();
		$('.tiempodeseado').empty();
  		
  		var uT = $('#unidadtiempo option:selected').val();
  		var C = $('.costoarticulo').val();
  		var h = $('.costoalmacenamiento').val();
  		var K = $('.costofijo').val();
  		var a = $('.tasaconsumo').val();
  		var L = $('.tiempoentrega').val();
  		var iA = $('.tiempoactual').val();

  		var QA = obtenerQA(a,K,h);
  		var tA = obtenerTA(a,K,h);
  		var T = obtenerCostoPedido(a,K,QA,h,C);
  		var tr = obtenerTr(L,tA);
  		var nivel = QA-(tA-tr)*a;
  		
  		var tiempoA = calcularInventarioActual(QA,iA,a,tA);
  		
  		//var T = obtenerT(a,K,QA,h);
  		alert("Análisis realizado con éxito");
  		
  		$('.QA').append(QA);
  		$('.tA').append("Cada "+tA+" "+uT);
  		$('.T').append("Costo: "+T);
  		$('.tr').append(tA-tr+" "+uT);
  		
  		$('.nivel').append(Math.round(Math.abs(nivel))+ " unidades");
  		$('.tiempodeseado').append("El inventario a las "+ iA +" " + uT + " es de "+ tiempoA  + " unidades");
  		mostrarGraficoCostos(a,K,QA,C,h);
  		mostrarGraficoInventario(a,tA,QA,C);
  		e.preventDefault();
  	/*https://doc.sagemath.org/html/en/reference/plot3d/sage/plot/plot3d/plot3d.html	*/
	});
</script>
</body>
</html>
